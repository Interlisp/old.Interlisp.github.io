<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>23-INTERACTIONS</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part25.htm">&lt; Previous</a><span> | </span><a href="../Medley-Primer.html">Contents</a><span> | </span><a href="part27.htm">Next &gt;</a></p><h1 style="padding-top: 5pt;padding-left: 71pt;text-indent: -36pt;line-height: 87%;text-align: left;"><a name="bookmark25">23. SIMPLE INTERACTIONS WITH THE CURSOR, A BITMAP, AND A WINDOW</a></h1><p style="padding-left: 35pt;text-indent: 0pt;line-height: 6pt;text-align: left;"><span><img width="640" height="8" alt="image" src="Image_157.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 15pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">The purpose of this chapter is to show you how to build a moderately tricky interactive interface with the various Medley display facilities. In particular how to move a large</p><p style="padding-left: 107pt;text-indent: 0pt;line-height: 106%;text-align: left;">bitmap (larger than 16 x 16 pixels) around inside a window. To do this, you will change the <span class="s3">CURSORINFN </span>and <span class="s3">CURSOROUTFN </span>properties of the window. If you would also like to then set the bitmap in place in the window, you must reset the <span class="s3">BUTTONEVENTFN </span>. This chapter explains how to create the mobile bitmap.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 35pt;text-indent: 0pt;text-align: left;">GETMOUSESTATE Example Function                                                           </h2><p style="padding-top: 9pt;padding-left: 107pt;text-indent: 0pt;line-height: 106%;text-align: left;">One function that you will use to &quot;trace the cursor&quot; (have a bitmap follow the cursor around in a window) is <span class="s3">GETMOUSESTATE</span>. This function finds the current state of the. mouse, and resets global system variables, such as <span class="s3">LASTMOUSEX </span>and <span class="s3">LASTMOUSEY</span>.</p><p style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">As an example of how this function works, create a window by typing</p><p class="s3" style="padding-top: 7pt;padding-left: 143pt;text-indent: 0pt;text-align: left;">(SETQ EXAMPLE.WINDOW (CREATEW))</p><p style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">into the Executive Window, and sweeping out a window. Now, type in the function</p><p class="s3" style="padding-top: 7pt;padding-left: 143pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(DEFINEQ (PRINTCOORDS (W)</p><p class="s3" style="padding-left: 173pt;text-indent: 0pt;line-height: 88%;text-align: left;">(PROMPTPRINT &quot;(&quot; LASTMOUSEX &quot;, &quot;LASTMOUSEY &quot;)&quot;) (BLOCK)</p><p class="s3" style="padding-left: 173pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(GETMOUSESTATE)))</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 107pt;text-indent: 0pt;text-align: left;">This function calls <span class="s3">GETMOUSESTATE </span>and then prints the new values of <span class="s3">LASTMOUSEX </span>and</p><p class="s3" style="padding-left: 107pt;text-indent: 0pt;text-align: left;">LASTMOUSEY <span class="p">in the promptwindow. To use it, type</span></p><p class="s3" style="padding-top: 7pt;padding-left: 143pt;text-indent: 0pt;text-align: left;">(WINDOWPROP EXAMPLE.WINDOW ’CURSORMOVEDFN ’PRINTCOORDS)</p><p style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;line-height: 107%;text-align: left;">The window property <span class="s3">CURSORMOVEDFN</span>, used in this example, will evaluate the function <span class="s3">PRINTCOORDS </span>each time the cursor is moved when it is inside the window. The position coordinates of the mouse cursor will appear in the prompt window. (See Figure 23.1.)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 128pt;text-indent: 0pt;text-align: left;">Figure 23.1. Current Position Coordinates of Mouse Cursor in Prompt Window</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 35pt;text-indent: 0pt;text-align: left;">Advising GETMOUSESTATE                                                                           </h2><p style="padding-top: 9pt;padding-left: 107pt;text-indent: 0pt;line-height: 107%;text-align: left;">For the bitmap to follow the moving mouse cursor, the function <span class="s3">GETMOUSESTATE </span>is advised. When you advise a function, you can add new commands to the function</p><p style="padding-left: 107pt;text-indent: 0pt;line-height: 11pt;text-align: left;">without knowing how it is actually implemented. The syntax for advise is</p><p class="s3" style="padding-top: 7pt;padding-left: 143pt;text-indent: 0pt;text-align: left;">(ADVISE <span class="s4">fn when where what</span>)</p><p class="s4" style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">fn <span class="p">is the name of the function to be augmented. </span>when <span class="p">and </span>where <span class="p">are optional</span></p><p style="padding-left: 107pt;text-indent: 0pt;text-align: left;">arguments. <i>when </i>specifies whether the change should be made before, after, or around the body of the function. The values expected are <span class="s3">BEFORE </span>, <span class="s3">AFTER</span>, or <span class="s3">AROUND</span>.</p><p class="s4" style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">what <span class="p">specifies the additional code.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">In the example, the additional code, <i>what</i>, moves the bitmap to the position of the</p><p style="padding-left: 107pt;text-indent: 0pt;text-align: left;">mouse cursor. The function <span class="s3">GETNOUSESTATE </span>will be <span class="s3">ADVISE</span>d when the mouse moves</p><p style="padding-left: 106pt;text-indent: 0pt;line-height: 106%;text-align: left;">into the window. This will cause the bitmap to follow the mouse cursor. <span class="s3">ADVISE </span>will be undone when the mouse leaves the window or when a mouse button is pushed. The <span class="s3">ADVISE</span>ing will be done and undone by changing the <span class="s3">CURSORINFN </span>, <span class="s3">CURSOROUTFN</span>, and <span class="s3">BUTTONEVENTFN </span>for the window.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 35pt;text-indent: 0pt;text-align: left;">Changing the Cursor                                                                                        </h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">One last part of the example, to give the impression that a bitmap is dragged around a window, the original cursor should disappear. Try typing:</p><p class="s3" style="padding-top: 6pt;padding-left: 143pt;text-indent: 0pt;text-align: left;">(CURSOR (CURSORCREATE (BITMAPCREATE 1 l) 1 1]</p><p style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">into the Executive Window. This causes the original cursor to disappear. It reappears when you type</p><p class="s3" style="padding-top: 6pt;padding-left: 143pt;text-indent: 0pt;text-align: left;">(CURSOR T)</p><p style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">When the cursor is invisible, and the bitmap moves as the cursor moves, the illusion is given that the bitmap is dragged around the window.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 35pt;text-indent: 0pt;text-align: left;">Functions for Tracing the Cursor                                                                   </h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">To actually have a bitmap trace (follow) the cursor, the environment must be set up so that when the cursor enters the tracing region the trace is turned on, and when the</p><p style="padding-left: 107pt;text-indent: 0pt;line-height: 106%;text-align: left;">cursor leaves the tracing region the trace is turned off. The function <span class="s3">Establish/Trace/Data </span>will do this. Type it in as it appears (include comments that will help you remember what the function does).</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-left: 107pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(DEFINEQ (Establish/Trace/Data</p><p class="s3" style="padding-left: 143pt;text-indent: -12pt;line-height: 88%;text-align: left;">[LAMBDA (wnd tracebitmap cursor/rightoffset cursor/heightoffset GCGAGP)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-left: 143pt;text-indent: 0pt;line-height: 88%;text-align: left;">(* * This function is called to establish the data to trace the desired bitmap. &quot;wnd&quot; is the window in which the tracing is to take place, &quot;tracebitmap&quot; is the tracing bitmap, &quot;cursor/rightoffset&quot; and &quot;cursor/heightoffset&quot; are integers which detemine the hotspot of the tracing bitmap.</p><p class="s3" style="padding-left: 143pt;text-indent: 0pt;line-height: 88%;text-align: left;">As &quot;cursor/heightoffset and &quot;cursor/rightoffset&quot; increase the cursor hotspot moves up and to the right.</p><p class="s3" style="padding-left: 143pt;text-indent: 0pt;line-height: 10pt;text-align: left;">If GCGAGP is non-NIL, GCGAG will be disabled.)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-left: 107pt;text-indent: 0pt;text-align: left;">(PROG NIL</p><p class="s3" style="padding-top: 8pt;padding-left: 143pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(if (OR (NULL wnd)</p><p class="s3" style="padding-left: 111pt;text-indent: 0pt;line-height: 10pt;text-align: center;">(NULL tracebitmap))</p><p class="s3" style="padding-left: 197pt;text-indent: -30pt;line-height: 88%;text-align: left;">then (PLAYTUNE (LIST (CONS 1000 4000))) (RETURN))</p><p class="s3" style="padding-left: 143pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(if GCGAGP</p><p class="s3" style="padding-left: 167pt;text-indent: 0pt;line-height: 11pt;text-align: left;">then (GCGAG))</p><p class="s3" style="padding-top: 8pt;padding-left: 155pt;text-indent: 0pt;text-align: left;">(* * Create a blank cursor.)</p><p class="s3" style="padding-top: 8pt;padding-left: 143pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(SETQ *BLANKCURSOR*(BITMAPCREATE 16 16))</p><p class="s3" style="padding-left: 143pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(SETQ *BLANKTRACECURSOR*(CURSORCREATE *BLANKCURSOR*))</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-top: 6pt;padding-left: 155pt;text-indent: 0pt;line-height: 88%;text-align: left;">(* * Set the CURSOR IN and OUT FNS for wnd to the following:)</p><p class="s3" style="padding-top: 9pt;padding-left: 143pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(WINDOWPROP wnd (QUOTE CURSORINFN)</p><p class="s3" style="padding-left: 143pt;text-indent: 72pt;line-height: 88%;text-align: left;">(FUNCTION SETUP/TRACE)) (WINDOWPROP wnd (QUOTE CURSOROUTFN)</p><p class="s3" style="padding-left: 215pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(FUNCTION UNTRACE/CURSOR))</p><p class="s3" style="padding-top: 9pt;padding-left: 161pt;text-indent: -6pt;line-height: 88%;text-align: left;">(* * To allow the bitmap to be set down in the window by pressing a mouse button, include this line.</p><p class="s3" style="padding-left: 161pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Otherwise, it is not needed)</p><p class="s3" style="padding-top: 8pt;padding-left: 143pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(WINDOWPROP wnd (QUOTE BUTTONEVENTFN)</p><p class="s3" style="padding-left: 143pt;text-indent: 72pt;line-height: 88%;text-align: left;">(FUNCTION PLACE/BITMAP/IN/WINDOW)) (WINDOWPROP wnd (QUOTE CURSOROUTFN)</p><p class="s3" style="padding-left: 143pt;text-indent: 12pt;line-height: 20pt;text-align: left;">(* * Set up Global Variables for the tracing operation) (SETQ *TRACEBITMAP* tracebitmap</p><p class="s3" style="padding-left: 143pt;text-indent: 0pt;line-height: 88%;text-align: left;">(SETQ *RIGHTTRACE/OFFSET*(OR cursor/rightoffset 0)) (SETQ *HEIGHTTRACE/OFFSET*(OR cxursor heightoffset 0)) (SETQ *OLDBITMAPPOSITION*(BITMAPCREATE (BITMAPWIDTH</p><p class="s3" style="padding-left: 161pt;text-indent: 0pt;line-height: 9pt;text-align: left;">tracebitmap)</p><p class="s3" style="padding-top: 9pt;padding-left: 161pt;text-indent: 0pt;line-height: 11pt;text-align: left;">tracebitmap)))</p><p class="s3" style="padding-left: 143pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(SETQ *TRACEWINDOW* wnd]))</p><p class="s3" style="padding-left: 75pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(BITMAPHEIGHT</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">When the function <span class="s3">Establish/Trace/Data </span>is called, the functions <span class="s3">SETUP/TRACE </span>and</p><p class="s3" style="padding-left: 107pt;text-indent: 0pt;line-height: 107%;text-align: left;">UNTRACE/CURSOR <span class="p">will be installed as the values of the window’s </span>WlNDOWPROPS <span class="p">, and will be used to turn the trace on and off. Those functions should be typed in, then:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-left: 131pt;text-indent: -24pt;line-height: 88%;text-align: left;">(DEFINEQ (SETUP/TRACE [LAMBDA (wnd)</p><p class="s3" style="padding-top: 9pt;padding-left: 143pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(* * This function is wnd’s CURSORINFN.</p><p class="s3" style="padding-left: 143pt;text-indent: 0pt;line-height: 88%;text-align: left;">It simply resets the last trace position and the current tracing region. It also readvises GETMOUSESTATE to perform the trace function after each call.)</p><p class="s3" style="padding-top: 9pt;padding-left: 131pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(if *TRACEBITMAP*</p><p class="s3" style="padding-left: 167pt;text-indent: -24pt;line-height: 88%;text-align: left;">then (SETQ *LAST-TRACE-XPOS* -2000) (SETQ *LAST-TRACE-YPOS* -2000)</p><p class="s3" style="padding-left: 167pt;text-indent: 0pt;line-height: 88%;text-align: left;">(SETQ *WNDREGION* (WINDOWPROP wnd (QUOTE REGION))) (WINDOWPROP wnd (QUOTE TRACING)</p><p class="s3" style="padding-left: 191pt;text-indent: 0pt;line-height: 10pt;text-align: left;">T)</p><p class="s3" style="padding-top: 8pt;padding-left: 143pt;text-indent: 0pt;text-align: left;">(* * make the cursor disappear)</p><p class="s3" style="padding-top: 9pt;padding-left: 143pt;text-indent: 0pt;line-height: 88%;text-align: left;">(CURSOR *BLANKTRACECURSOR*) (ADVISE (QUOTE GETMOUSESTATE)</p><p class="s3" style="padding-left: 179pt;text-indent: 0pt;line-height: 88%;text-align: left;">(QUOTE AFTER) NIL</p><p class="s3" style="padding-left: 179pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(QUOTE (TRACE/CURSOR]))</p><p class="s3" style="padding-top: 9pt;padding-left: 113pt;text-indent: -6pt;line-height: 88%;text-align: left;">(DEFINEQ (UNTRACE/CURSOR [LAMBDA (wnd)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-left: 143pt;text-indent: 0pt;line-height: 88%;text-align: left;">(* * This function is wnd’s CURSOROUTFN. The function first checks if the cursor is currently being traced; if so, it replaces the tracing bitmap with what is under it and then turns tracing off by unadvising GETMOUSESTATE and setting the TRACING window property of *TRACEWINDOW* to NIL.)</p><p class="s3" style="padding-top: 9pt;padding-left: 113pt;text-indent: 0pt;text-align: left;">(if (WINDOWPROP *TRACEWINDOW*(QUOTE TRACING))</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-top: 6pt;padding-left: 191pt;text-indent: -48pt;line-height: 88%;text-align: left;">then (BITBLT *OLDBITMAPPOSITION* 0 0 (SCREENBITMAP) (IPLUS (CAR *WNDREGION*)*LAST-TRACE-XPOS*) (IPLUS (CADR *WNDREGION*)*LAST-TRACE-YPOS*))</p><p class="s3" style="padding-left: 167pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(WINDOWPROP *TRACEWINDOW*(QUOTE TRACING)</p><p class="s3" style="padding-left: 287pt;text-indent: 0pt;line-height: 11pt;text-align: left;">NIL))</p><p class="s3" style="padding-top: 8pt;padding-left: 113pt;text-indent: 29pt;line-height: 177%;text-align: left;">(* * replace the original cursor shape) (CURSOR T)</p><p class="s3" style="padding-left: 113pt;text-indent: 29pt;line-height: 177%;text-align: left;">(* * unadvise GETMOUSESTATE) (UNADVISE (QUOTE GETMOUSESTATE]))</p><p style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">The function <span class="s3">SETUP/TRACE </span>has a helper function that you must also type in. It is</p><p class="s3" style="padding-left: 107pt;text-indent: 0pt;text-align: left;">TRACE/CURSOR<span class="p">:</span></p><p class="s3" style="padding-top: 8pt;padding-left: 113pt;text-indent: -6pt;line-height: 88%;text-align: left;">(DEFINEQ (TRACE/CURSOR [LAMBDA NIL</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-left: 143pt;text-indent: 0pt;line-height: 88%;text-align: left;">(* * This function does the actual BITBLTing of the tracing bitmap. This function is called after a GETMOUSESTATE, while tracing.)</p><p class="s3" style="padding-top: 6pt;padding-left: 34pt;text-indent: 0pt;line-height: 11pt;text-align: center;">(PROG ((xpos (IDIFFERENCE (LASTMOUSEX *TRACEWINDOW*)</p><p class="s3" style="padding-left: 191pt;text-indent: 0pt;line-height: 11pt;text-align: left;">*RIGHTTRACE/OFFSET*))</p><p class="s3" style="padding-top: 5pt;padding-left: 75pt;text-indent: 0pt;line-height: 11pt;text-align: center;">(ypos (IDIFFERENCE (LASTMOUSEY *TRACEWINDOW*)</p><p class="s3" style="padding-left: 191pt;text-indent: 0pt;line-height: 11pt;text-align: left;">*HEIGHTTRACE/OFFSET*))</p><p class="s3" style="padding-top: 6pt;padding-left: 143pt;text-indent: 0pt;line-height: 88%;text-align: left;">(* * If there is an error in the function, press the right button to unadvise the function. This will keep the machine from locking up.)</p><p class="s3" style="padding-top: 6pt;padding-left: 143pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(if (LASTMOUSESTATE RIGHT)</p><p class="s3" style="padding-left: 143pt;text-indent: 24pt;line-height: 88%;text-align: left;">then (UNADVISE (QUOTE GETMOUSESTATE))) (if (AND (NEQ xpos *LAST-TRACE-XPOS*)</p><p class="s3" style="padding-left: 197pt;text-indent: 0pt;line-height: 9pt;text-align: left;">(NEQ ypos *LAST-TRACE-YPOS*))</p><p class="s3" style="padding-left: 167pt;text-indent: 0pt;text-align: left;">then</p><p class="s3" style="padding-top: 6pt;padding-left: 143pt;text-indent: 0pt;line-height: 90%;text-align: left;">(* * Restore what was under the old position of the trace bitmap<span class="s13">)</span></p><p class="s3" style="padding-top: 6pt;padding-left: 191pt;text-indent: -24pt;line-height: 88%;text-align: left;">(BITBLT *OLDBITMAPPOSITION* 0 0 (SCREENBITMAP) (IPLUS (CAR *WNDREGION*)*LAST-TRACE-XPOS*) (IPLUS (CADR *WNDREGION*)*LAST-TRACE-YPOS*))</p><p class="s3" style="padding-top: 7pt;padding-left: 143pt;text-indent: 0pt;line-height: 88%;text-align: left;">(* * Save what will be under the position of the new trace bitmap)</p><p class="s3" style="padding-top: 7pt;padding-left: 191pt;text-indent: -24pt;line-height: 88%;text-align: left;">(BITBLT (SCREENBITMAP) (IPLUS (CAR *WNDREGION*)</p><p class="s3" style="padding-left: 111pt;text-indent: 0pt;line-height: 10pt;text-align: center;">xpos)</p><p class="s3" style="padding-left: 215pt;text-indent: -24pt;line-height: 88%;text-align: left;">(IPLUS (CADR *WNDREGION*) ypos)*OLDBITMAPPOSITION* 0 0)</p><p class="s3" style="padding-top: 7pt;padding-left: 143pt;text-indent: 0pt;line-height: 88%;text-align: left;">(* * BITBLT the trace bitmap onto the new position of the mouse)</p><p class="s3" style="padding-top: 7pt;padding-left: 191pt;text-indent: -24pt;line-height: 88%;text-align: left;">(BITBLT *TRACEBITMAP* 0 0 (SCREENBITMAP) (IPLUS (CAR *WNDREGION*)</p><p class="s3" style="padding-left: 111pt;text-indent: 0pt;line-height: 10pt;text-align: center;">xpos)</p><p class="s3" style="padding-left: 191pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(IPLUS (CADR *WNDREGION*)</p><p class="s3" style="padding-left: 111pt;text-indent: 0pt;line-height: 10pt;text-align: center;">ypos)</p><p class="s3" style="padding-left: 191pt;text-indent: 0pt;line-height: 88%;text-align: left;">NIL NIL (QUOTE INPUT) (QUOTE PAINT))</p><p class="s3" style="padding-top: 6pt;padding-left: 167pt;text-indent: -24pt;line-height: 150%;text-align: left;">(* * Save the current position as the last trace position.) (SETQ *LAST-TRACE-XPOS* xpos)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-top: 5pt;padding-left: 167pt;text-indent: 0pt;text-align: left;">(SETQ *LAST-TRACE-YPOS* ypos]))</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 107pt;text-indent: 0pt;line-height: 107%;text-align: left;">The helper function for <span class="s3">UNTRACE/CURSOR </span>, called <span class="s3">UNDO/TRACE/DATA</span>, must also be added to the environment:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-left: 131pt;text-indent: -24pt;line-height: 88%;text-align: left;">(DEFINEQ (UNDO/TRACE/DATA [LAMBDA NIL</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-left: 179pt;text-indent: -6pt;line-height: 88%;text-align: left;">(* * The purpose of this function is to turn tracing off and to free up the global variables used to trace the bitmap so that they can be garbage collected.)</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-left: 179pt;text-indent: 0pt;line-height: 88%;text-align: left;">(* * Check if the cursor is currently being traced. It so, turn it off.)</p><p class="s3" style="padding-top: 9pt;padding-left: 143pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(UNTRACE/CURSOR)</p><p class="s3" style="padding-left: 215pt;text-indent: -72pt;line-height: 88%;text-align: left;">(WINDOWPROP *TRACEWINDOW*(QUOTE CURSORINFN) NIL)</p><p class="s3" style="padding-left: 215pt;text-indent: -72pt;line-height: 88%;text-align: left;">(WINDOWPROP *TRACEWINDOW*(QUOTE CURSOROUTFN) NIL)</p><p class="s3" style="padding-left: 143pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(SETQ *TRACEBITMAP* NIL)</p><p class="s3" style="padding-left: 143pt;text-indent: 0pt;line-height: 88%;text-align: left;">(SETQ *RIGHTTRACE/OFFSET* NIL) (SETQ *HEIGHTTRACE/OFFSET* NIL) (SETQ *OLDBITMAPPOSITION* NIL) (SETQ *TRACEWINDOW* NIL)</p><p class="s3" style="padding-top: 9pt;padding-left: 143pt;text-indent: 30pt;line-height: 177%;text-align: left;">(* * Turn GCGAG on) (GCGAG T]))</p><p style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;line-height: 107%;text-align: left;">Finally, if you included the <span class="s3">WlNDOWPROP </span>to allow the user to place the bitmap in the window by pressing a mouse button, you must also type this function:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s3" style="padding-left: 131pt;text-indent: -24pt;line-height: 88%;text-align: left;">(DEFINEQ (PLACE/BITMAP/IN/WINDOW [LAMBDA (wnd)</p><p class="s3" style="padding-top: 9pt;padding-left: 143pt;text-indent: 0pt;line-height: 11pt;text-align: left;">(UNADVISE (GETMOUSESTATE))</p><p class="s3" style="padding-left: 173pt;text-indent: -30pt;line-height: 88%;text-align: left;">(BITBLT *TRACEBITMAP* 0 0 (SCREENBITMAP) (IPLUS (CAR *WNDREGION*)</p><p class="s3" style="padding-left: 111pt;text-indent: 0pt;line-height: 10pt;text-align: center;">xpos)</p><p class="s3" style="padding-left: 173pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(IPLUS (CADR *WNDREGION*)</p><p class="s3" style="padding-left: 111pt;text-indent: 0pt;line-height: 10pt;text-align: center;">ypos)</p><p class="s3" style="padding-left: 173pt;text-indent: 0pt;line-height: 88%;text-align: left;">NIL NIL (QUOTE INPUT) (QUOTE PAINT]</p><p style="padding-top: 6pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">That’s all the functions!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><h2 style="padding-left: 35pt;text-indent: 0pt;text-align: left;">Running the Functions                                                                                    </h2><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">To run the functions you just typed in, first set a variable to a window by typing something like</p><p class="s3" style="padding-top: 6pt;padding-left: 143pt;text-indent: 0pt;text-align: left;">(SETQ EXAMPLE.WINDOW (CREATEW))</p><p style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">into the Executive Window, and sweeping out a new window. Now, set a variable to a bitmap, by typing, perhaps,</p><p class="s3" style="padding-top: 6pt;padding-left: 143pt;text-indent: 0pt;text-align: left;">(SETQ EXAMPLE.BTM (EDITBM))</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">Type</p><p class="s3" style="padding-top: 7pt;padding-left: 143pt;text-indent: 0pt;text-align: left;">(Estab1ish/Trace/Data EXAMPLE.WINDOW EXAMPLE.BTM))</p><p style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">When you move the cursor into the window, the cursor will drag the bitmap.</p><p style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">(If you want to be able to make menu selections while tracing the cursor, make sure</p><p style="padding-left: 107pt;text-indent: 0pt;text-align: left;">that the hotspot of the cursor is set to the extreme right of the bitmap. Otherwise, the menu will be destroyed by the <span class="s3">BITBLT </span>s of the trace functions.)</p><p style="padding-top: 7pt;padding-left: 107pt;text-indent: 0pt;text-align: left;">To stop tracing, do one of the following:</p><p style="padding-top: 7pt;padding-left: 108pt;text-indent: 0pt;text-align: left;">• Move the mouse cursor out of the window</p><p style="padding-top: 7pt;padding-left: 108pt;text-indent: 0pt;text-align: left;">• Press the right mouse button</p><p style="padding-top: 7pt;padding-left: 108pt;text-indent: 0pt;text-align: left;">• Call the function <span class="s3">UNTRACE/CURSOR</span></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part25.htm">&lt; Previous</a><span> | </span><a href="../Medley-Primer.html">Contents</a><span> | </span><a href="part27.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
